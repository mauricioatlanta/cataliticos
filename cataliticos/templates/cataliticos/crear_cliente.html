
{% extends 'base.html' %}
{% block title %}Nuevo Cliente Futurista{% endblock %}
{% block content %}
<style>
/* Forzar todos los textos a negro en el formulario */
.futuristic-input,
.futuristic-label,
label,
input,
select,
textarea,
.futuristic-btn,
option,
.futuristic-input::placeholder {
  color: #111 !important;
  text-shadow: none !important;
}
/* Fondo gal√°ctico animado */
.galaxy-bg {
  position: fixed;
  top: 0; left: 0; width: 100vw; height: 100vh;
/* Forzar todos los textos a negro en el formulario */
.futuristic-input,
.futuristic-label,
label,
input,
select,
textarea,
.futuristic-btn,
option,
.futuristic-input::placeholder {
  color: #111 !important;
  text-shadow: none !important;
}
    <!-- Estrellas -->
    <circle class="star" cx="10%" cy="15%" r="2"/>
    <circle class="star2" cx="30%" cy="80%" r="1.5"/>
    <circle class="star3" cx="60%" cy="40%" r="2.5"/>
    <circle class="star" cx="80%" cy="25%" r="1.2"/>
    <circle class="star2" cx="50%" cy="60%" r="1.8"/>
    <circle class="star3" cx="90%" cy="70%" r="1.3"/>
    <circle class="star" cx="20%" cy="50%" r="1.1"/>
    <circle class="star2" cx="70%" cy="85%" r="1.7"/>
    <circle class="star3" cx="40%" cy="30%" r="1.4"/>
    <circle class="star" cx="85%" cy="10%" r="1.6"/>
    <circle class="star2" cx="15%" cy="75%" r="1.3"/>
    <circle class="star3" cx="60%" cy="90%" r="1.2"/>
    <!-- M√°s estrellas peque√±as -->
    <circle class="star" cx="12%" cy="60%" r="0.8"/>
    <circle class="star2" cx="25%" cy="30%" r="0.7"/>
    <circle class="star3" cx="77%" cy="55%" r="0.9"/>
    <circle class="star" cx="33%" cy="10%" r="0.6"/>
    <circle class="star2" cx="88%" cy="40%" r="0.7"/>
    <circle class="star3" cx="55%" cy="15%" r="0.8"/>
    <!-- Planeta grande -->
    <circle cx="85%" cy="80%" r="32" fill="url(#planet1)" filter="url(#planetShadow)"/>
    <defs>
      <radialGradient id="planet1" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#fff"/>
        <stop offset="60%" stop-color="#00fff7"/>
        <stop offset="100%" stop-color="#0f2027"/>
      </radialGradient>
      <filter id="planetShadow" x="-20%" y="-20%" width="140%" height="140%">
        <feDropShadow dx="-8" dy="8" stdDeviation="8" flood-color="#00fff7"/>
      </filter>
    </defs>
    <!-- Planeta peque√±o -->
    <circle cx="18%" cy="88%" r="12" fill="url(#planet2)"/>
    <defs>
      <radialGradient id="planet2" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#fff"/>
        <stop offset="70%" stop-color="#b388ff"/>
        <stop offset="100%" stop-color="#2c5364"/>
      </radialGradient>
    </defs>
    <!-- Cometa animado -->
    <g>
      <animateTransform attributeName="transform" type="translate" from="-100 40" to="900 200" dur="7s" repeatCount="indefinite"/>
      <ellipse cx="0" cy="0" rx="18" ry="4" fill="url(#cometTail)" opacity="0.7"/>
      <circle cx="18" cy="0" r="4" fill="#fff"/>
      <defs>
        <linearGradient id="cometTail" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0%" stop-color="#fff" stop-opacity="0.8"/>
          <stop offset="100%" stop-color="#00fff7" stop-opacity="0"/>
        </linearGradient>
      </defs>
    </g>
    <!-- Segundo cometa -->
    <g>
      <animateTransform attributeName="transform" type="translate" from="900 100" to="-100 400" dur="10s" repeatCount="indefinite"/>
      <ellipse cx="0" cy="0" rx="10" ry="2.5" fill="url(#cometTail2)" opacity="0.5"/>
      <circle cx="10" cy="0" r="2.5" fill="#b388ff"/>
      <defs>
        <linearGradient id="cometTail2" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0%" stop-color="#b388ff" stop-opacity="0.7"/>
          <stop offset="100%" stop-color="#fff" stop-opacity="0"/>
        </linearGradient>
      </defs>
    </g>
  </svg>
</div>
<div class="relative max-w-3xl mx-auto p-10 futuristic-glass shadow-2xl mt-10 mb-16" style="font-family:'Orbitron',sans-serif; z-index:2;">
  <div class="futuristic-anim-bg"></div>
  <h1 class="text-4xl neon font-extrabold mb-8 text-center tracking-widest drop-shadow-lg">üë§ Crear Nuevo Cliente</h1>
  <div class="mb-6 p-4 bg-black/40 border border-cyan-400/30 rounded-xl relative z-10">
    <p class="text-base futuristic-label">
      <strong>Nota:</strong> Solo el campo <span class="neon">Nombre</span> <span class="text-red-400">*</span> es obligatorio. Todos los dem√°s campos son opcionales.
    </p>
  </div>
  <form method="post" class="space-y-6 relative z-10">
    {% csrf_token %}
    {% if form.errors %}
      <div class="bg-red-500/20 border border-red-400/30 rounded-xl p-4 mb-4 text-red-200 shadow-lg">
        <h3 class="font-bold mb-2 neon">‚ö†Ô∏è Errores en el formulario:</h3>
        {% for field, errors in form.errors.items %}
          <ul class="text-sm">
            {% for error in errors %}
              <li>{{ field }}: {{ error }}</li>
            {% endfor %}
          </ul>
        {% endfor %}
      </div>
    {% endif %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div>
        <label for="{{ form.nombre.id_for_label }}" class="futuristic-label block mb-2">
          {{ form.nombre.label }} <span class="text-red-400">*</span>
        </label>
        <input type="text" name="{{ form.nombre.name }}" id="{{ form.nombre.id_for_label }}" 
               value="{{ form.nombre.value|default:'' }}"
               class="futuristic-input w-full px-4 py-3 text-lg placeholder-cyan-200/60 focus:ring-2 focus:ring-cyan-300"
               placeholder="Nombre del cliente" required autocomplete="off">
      </div>
      <div>
        <label for="{{ form.apellido.id_for_label }}" class="futuristic-label block mb-2">
          {{ form.apellido.label }}
        </label>
        <input type="text" name="{{ form.apellido.name }}" id="{{ form.apellido.id_for_label }}" 
               value="{{ form.apellido.value|default:'' }}"
               class="futuristic-input w-full px-4 py-3 text-lg placeholder-cyan-200/60 focus:ring-2 focus:ring-cyan-300"
               placeholder="Apellido (opcional)" autocomplete="off">
      </div>
      <div>
        <label for="{{ form.rut.id_for_label }}" class="futuristic-label block mb-2">
          {{ form.rut.label }}
        </label>
        <input type="text" name="{{ form.rut.name }}" id="{{ form.rut.id_for_label }}" 
               value="{{ form.rut.value|default:'' }}"
               class="futuristic-input w-full px-4 py-3 text-lg placeholder-cyan-200/60 focus:ring-2 focus:ring-cyan-300"
               placeholder="12345678-9 (opcional)" autocomplete="off">
      </div>
      <div>
        <label for="{{ form.telefono.id_for_label }}" class="futuristic-label block mb-2">
          {{ form.telefono.label }}
        </label>
        <input type="text" name="{{ form.telefono.name }}" id="{{ form.telefono.id_for_label }}" 
               value="{{ form.telefono.value|default:'' }}"
               class="futuristic-input w-full px-4 py-3 text-lg placeholder-cyan-200/60 focus:ring-2 focus:ring-cyan-300"
               placeholder="Tel√©fono (opcional)" autocomplete="off">
      </div>
      <div class="md:col-span-2">
        <label for="{{ form.correo.id_for_label }}" class="futuristic-label block mb-2">
          {{ form.correo.label }}
        </label>
        <input type="email" name="{{ form.correo.name }}" id="{{ form.correo.id_for_label }}" 
               value="{{ form.correo.value|default:'' }}"
               class="futuristic-input w-full px-4 py-3 text-lg placeholder-cyan-200/60 focus:ring-2 focus:ring-cyan-300"
               placeholder="correo@ejemplo.com (opcional)" autocomplete="off">
      </div>
      <div class="md:col-span-2">
        <label for="{{ form.direccion.id_for_label }}" class="futuristic-label block mb-2">
          {{ form.direccion.label }}
        </label>
        <input type="text" name="{{ form.direccion.name }}" id="{{ form.direccion.id_for_label }}" 
               value="{{ form.direccion.value|default:'' }}"
               class="futuristic-input w-full px-4 py-3 text-lg placeholder-cyan-200/60 focus:ring-2 focus:ring-cyan-300"
               placeholder="Direcci√≥n completa (opcional)" autocomplete="off">
      </div>
      <div>
        <label for="id_region" class="futuristic-label block mb-2">Regi√≥n <span class="text-red-400">*</span></label>
        <div class="relative">
          {{ form.region }}
          <span class="absolute right-4 top-1/2 -translate-y-1/2 text-cyan-400 pointer-events-none">
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
          </span>
        </div>
      </div>
      <div>
        <label for="id_ciudad" class="futuristic-label block mb-2">Ciudad <span class="text-red-400">*</span></label>
        <div class="relative">
          {{ form.ciudad }}
          <span class="absolute right-4 top-1/2 -translate-y-1/2 text-cyan-400 pointer-events-none">
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
          </span>
        </div>
        <div class="mt-3 flex gap-2 items-center">
          {{ form.nueva_ciudad }}
          <button type="button" id="btn-agregar-ciudad" class="futuristic-btn px-4 py-2 text-base">Agregar ciudad</button>
        </div>
      </div>
    </div>
    <hr class="futuristic-hr">
    <div class="flex flex-col md:flex-row gap-4 mt-8">
      <button type="submit" class="futuristic-btn flex-1">‚úÖ Guardar Cliente</button>
      <a href="{% url 'cataliticos:listado' %}" class="futuristic-btn flex-1 !bg-gradient-to-r !from-gray-700 !to-gray-900 !text-cyan-200 hover:!from-gray-900 hover:!to-gray-700">‚ùå Cancelar</a>
    </div>
  </form>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(function() {
  // Al cambiar regi√≥n, cargar ciudades
  $('#id_region').change(function() {
    var regionId = $(this).val();
    $('#id_ciudad').html('<option value="">Cargando...</option>');
    if(regionId) {
      $.get('/cataliticos/ajax/ciudades-por-region/', {region_id: regionId}, function(data) {
        var options = '<option value="">Selecciona una ciudad</option>';
        data.ciudades.forEach(function(ciudad) {
          options += `<option value="${ciudad.id}">${ciudad.nombre}</option>`;
        });
        $('#id_ciudad').html(options);
      });
    } else {
      $('#id_ciudad').html('<option value="">Selecciona una ciudad</option>');
    }
  });
  // Agregar ciudad nueva v√≠a AJAX
  $('#btn-agregar-ciudad').click(function(e) {
    e.preventDefault();
    var regionId = $('#id_region').val();
    var nombreCiudad = $('#id_nueva_ciudad').val();
    if(regionId && nombreCiudad) {
      $.post('/cataliticos/ajax/agregar-ciudad/', {
        region_id: regionId,
        nombre: nombreCiudad,
        csrfmiddlewaretoken: $('[name=csrfmiddlewaretoken]').val()
      }, function(data) {
        if(data.ok) {
          // Agregar la nueva ciudad al select y seleccionarla
          $('#id_ciudad').append(`<option value="${data.ciudad.id}" selected>${data.ciudad.nombre}</option>`);
          $('#id_nueva_ciudad').val('');
          // Animaci√≥n de √©xito
          $('<div class="fixed top-8 left-1/2 -translate-x-1/2 px-8 py-4 rounded-2xl neon text-2xl shadow-2xl z-[9999]" style="background:rgba(0,255,247,0.15);border:2px solid #00fff7;">Ciudad agregada correctamente üöÄ</div>')
            .appendTo('body').hide().fadeIn(200).delay(1200).fadeOut(400, function(){$(this).remove();});
        } else {
          alert(data.error || 'Error al agregar ciudad');
        }
      });
    } else {
      // Animaci√≥n de error
      $('<div class="fixed top-8 left-1/2 -translate-x-1/2 px-8 py-4 rounded-2xl bg-red-600/80 text-white text-xl shadow-2xl z-[9999]">Selecciona una regi√≥n y escribe el nombre de la ciudad.</div>')
        .appendTo('body').hide().fadeIn(200).delay(1200).fadeOut(400, function(){$(this).remove();});
    }
  });
});
</script>
{% endblock %}
